version: v1.0
name: Packet Deployment
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: "Build"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
      jobs:
      - name: Terraform init
        commands:
          - checkout
          - ls -1
          - wget https://releases.hashicorp.com/terraform/0.11.13/terraform_0.11.13_linux_amd64.zip
          - unzip terraform_0.11.13_linux_amd64.zip
          - sudo mv terraform /usr/local/bin/
          - cd packet
          - ls
          - terraform init
          - ls ~/azurePlay
          - terraform plan -var-file=packet.yml
          - terraform apply -auto-approve -var-file=packet.yml